"use strict";(self.webpackChunkweb_components_toolbox_storybook=self.webpackChunkweb_components_toolbox_storybook||[]).push([[4770],{"./src/web-components-toolbox/src/es/components/controllers/recipe/Recipe.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Recipe});var _prototypes_Shadow_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/web-components-toolbox/src/es/components/prototypes/Shadow.js");function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return(key=function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"==typeof key?key:String(key)}(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var importMeta={url:new URL("./src/web-components-toolbox/src/es/components/controllers/recipe/Recipe.js",document.baseURI).href};class Recipe extends((0,_prototypes_Shadow_js__WEBPACK_IMPORTED_MODULE_0__.j)()){constructor(){for(var _this,options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];super(_objectSpread({importMetaUrl:importMeta.url,mode:"false"},options),...args),_this=this,this.origTitle=document.title,this.abortController=null,this.RECIPE_CATEGORIES=Recipe.parseAttribute(this.getAttribute("recipe_categories"))||{Drinks:!1,Appetizers:!1,MainDishes:!1,DessertsAndBaking:!1,DIY:!1,Vegetarian:!1,Vegan:!1,GlutenFree:!1,LactoseFree:!1};var limit=this.getAttribute("limit");this.requestListRecipeListener=function(){var _ref=_asyncToGenerator((function*(event){_this.abortController&&_this.abortController.abort(),_this.abortController=new AbortController;var recipeData=JSON.parse(_this.getRecipeSelection());if(event.detail)if(event.detail.tags)recipeData[event.detail.tags[0]]=event.detail.isActive;else if(event.detail.tag||!event.detail.page&&!event.detail.skip&&!event.detail.key){for(var key in recipeData)recipeData[key]=!1;event.detail.tag&&(recipeData=Object.assign(recipeData,event.detail.tag.split(";").reduce(((acc,tag)=>(acc[tag]=!0,acc)),{})))}else if(!event.detail.key&&!event.detail.skip)for(var _key2 in recipeData)recipeData[_key2]=!1;var pushHistory=event&&event.detail&&event.detail.pushHistory,variables={limit:event.detail&&void 0!==event.detail.limit?Number(event.detail.limit):Number(limit),tags:_this.getTags()};if(event.detail&&void 0!==event.detail.tags){var selected=Object.fromEntries(Object.entries(recipeData).filter((_ref2=>{var[key]=_ref2;return recipeData[key]})));variables.tags=Object.keys(selected).join(";"),_this.setTag(variables.tags,pushHistory)}for(var _key3 in recipeData){var tags=void 0;(tags=_this.getTags())&&tags.includes(_key3)&&(recipeData[_key3]=!0)}_this.setRecipeSelection(recipeData),Object.entries(recipeData).some((entry=>entry[1]))&&_this.setTitle({detail:{textContent:Object.entries(recipeData).reduce(((acc,entry,i)=>entry[1]?acc+(0===i?"":" ")+entry[0]:acc),"")||_this.origTitle}}),event.detail&&void 0!==event.detail.skip?(variables.skip=Number(event.detail.skip),_this.setPage(String(variables.skip+1),pushHistory)):variables.skip=_this.getCurrentPageSkip(),_this.setSearchTerm(event.detail);var fetchOptions={method:"GET",signal:_this.abortController.signal},endpoint=_this.getAttribute("endpoint");endpoint+="?limit=".concat(variables.limit,"&skip=").concat(variables.skip,"&").concat(_this.createRecipeSelectionPayload(recipeData),"&searchTerm=").concat(_this.getSearchTerm()),_this.dispatchEvent(new CustomEvent(_this.getAttribute("list-recipe")||"list-recipe",{detail:{fetch:fetch(endpoint,fetchOptions).then(function(){var _ref3=_asyncToGenerator((function*(response){if(response.status>=200&&response.status<=299){var data=yield response.json();return{searchTerm:_this.getSearchTerm(),items:data.data.recipes.results,limit:data.data.recipes.limit,skip:data.data.recipes.skip,tag:variables.tags?variables.tags.split(";"):[],total:data.data.recipes.total}}throw new Error(response.statusText)}));return function(_x2){return _ref3.apply(this,arguments)}}())},bubbles:!0,cancelable:!0,composed:!0}))}));return function(_x){return _ref.apply(this,arguments)}}(),this.requestHrefEventListener=event=>{event.detail&&event.detail.resolve&&event.detail.resolve(this.setTag(event.detail.tags.join(";"),event.detail.pushHistory).href)},this.updatePopState=event=>{event.detail||(event.detail=_objectSpread({},event.state)),event.detail.pushHistory=!1,this.requestListRecipeListener(event)}}connectedCallback(){this.addEventListener(this.getAttribute("request-list-recipe")||"request-list-recipe",this.requestListRecipeListener),this.addEventListener("request-href-"+(this.getAttribute("request-list-recipe")||"request-list-recipe"),this.requestHrefEventListener),this.hasAttribute("no-popstate")||self.addEventListener("popstate",this.updatePopState)}disconnectedCallback(){this.removeEventListener(this.getAttribute("request-list-recipe")||"request-list-recipe",this.requestListRecipeListener),this.removeEventListener("request-href-"+(this.getAttribute("request-list-recipe")||"request-list-recipe"),this.requestHrefEventListener),this.hasAttribute("no-popstate")||self.removeEventListener("popstate",this.updatePopState)}createRecipeSelectionPayload(recipeSelection){var recipePayload=[];return Object.keys(recipeSelection).forEach((key=>{var str="".concat(key,"=").concat(recipeSelection[key]);recipePayload.push(str)})),recipePayload.join("&")}getRecipeSelection(){var recipes=sessionStorage.getItem("recipes");return recipes||(sessionStorage.setItem("recipes",JSON.stringify(this.RECIPE_CATEGORIES)),recipes=JSON.stringify(this.RECIPE_CATEGORIES)),recipes}setRecipeSelection(recipeSelection){sessionStorage.setItem("recipes",JSON.stringify(recipeSelection))}setSearchTerm(eventDetail){var pushHistory=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(eventDetail&&"inputSearch"===eventDetail.key){var searchTerm=eventDetail.value,url=new URL(location.href,"/"===location.href.charAt(0)?location.origin:"."===location.href.charAt(0)?this.importMetaUrl:void 0);url.searchParams.set("search-term",searchTerm),pushHistory&&history.pushState(_objectSpread(_objectSpread({},history.state),{},{searchTerm}),document.title,url.href)}}getSearchTerm(){return new URLSearchParams(location.search).get("search-term")||""}setTag(tag){var pushHistory=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],url=new URL(location.href,"/"===location.href.charAt(0)?location.origin:"."===location.href.charAt(0)?this.importMetaUrl:void 0);return url.searchParams.set("tag",tag),url.searchParams.set("page","1"),pushHistory&&history.pushState(_objectSpread(_objectSpread({},history.state),{},{tag,page:"1"}),document.title,url.href),url}getTags(){var tag=new URLSearchParams(location.search).get("tag");if(tag)return tag}setPage(page){var pushHistory=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],url=new URL(location.href,"/"===location.href.charAt(0)?location.origin:"."===location.href.charAt(0)?this.importMetaUrl:void 0);"1"===page?url.searchParams.delete("page"):url.searchParams.set("page",page),pushHistory&&history.pushState(_objectSpread(_objectSpread({},history.state),{},{tag:this.getTags(),page}),document.title,url.href)}getPage(){var urlParams=new URLSearchParams(location.search);return Number(urlParams.get("page")||1)}getCurrentPageSkip(){return this.getPage()-1}setTitle(event){var textContent,addToTitle=arguments.length>1&&void 0!==arguments[1]&&arguments[1];event&&event.detail&&event.detail.textContent&&(textContent=event.detail.textContent.trim())&&(addToTitle?(document.title=document.title.replace(new RegExp("(.*)".concat(addToTitle.replace(/\s/g,"\\s").replace(/\|/g,"\\|"),".*")),"$1"),document.title+=addToTitle+textContent):document.title.includes("|")?document.title=document.title.replace(/[^|]*(.*)/,textContent+" $1"):document.title=textContent)}}}}]);